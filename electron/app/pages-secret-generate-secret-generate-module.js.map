{"version":3,"sources":["./src/app/pages/secret-generate/secret-generate.module.ts","./src/app/pages/secret-generate/secret-generate.page.ts","./src/app/pages/secret-generate/secret-generate.page.html"],"names":[],"mappings":"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","file":"pages-secret-generate-secret-generate-module.js","sourcesContent":["import { CommonModule } from '@angular/common'\nimport { NgModule } from '@angular/core'\nimport { FormsModule } from '@angular/forms'\nimport { RouterModule, Routes } from '@angular/router'\nimport { IonicModule } from '@ionic/angular'\nimport { TranslateModule } from '@ngx-translate/core'\n\nimport { ComponentsModule } from './../../components/components.module'\nimport { SecretGeneratePage } from './secret-generate.page'\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: SecretGeneratePage\n  }\n]\n\n@NgModule({\n  imports: [CommonModule, FormsModule, IonicModule, RouterModule.forChild(routes), TranslateModule, ComponentsModule],\n  declarations: [SecretGeneratePage]\n})\nexport class SecretGeneratePageModule {}\n","import { ChangeDetectorRef, Component, ElementRef, OnInit, ViewChild } from '@angular/core'\nimport { Platform } from '@ionic/angular'\nimport { auditTime } from 'rxjs/operators'\n\nimport { TouchEntropyComponent } from '../../components/touch-entropy/touch-entropy.component'\nimport { Secret } from '../../models/secret'\nimport { AudioNativeService } from '../../services/audio/audio.native.servive'\nimport { CameraNativeService } from '../../services/camera/camera.native.service'\nimport { EntropyService } from '../../services/entropy/entropy.service'\nimport { ErrorCategory, handleErrorLocal } from '../../services/error-handler/error-handler.service'\nimport { GyroscopeNativeService } from '../../services/gyroscope/gyroscope.native.service'\nimport { NavigationService } from '../../services/navigation/navigation.service'\nimport { PermissionsService, PermissionTypes } from '../../services/permissions/permissions.service'\n\n@Component({\n  selector: 'airgap-secret-generate',\n  templateUrl: './secret-generate.page.html',\n  styleUrls: ['./secret-generate.page.scss']\n})\nexport class SecretGeneratePage implements OnInit {\n  public isBrowser: boolean = false\n\n  @ViewChild('videoElement')\n  public videoElement: ElementRef\n\n  @ViewChild('touchEntropy', { static: true })\n  public touchEntropy: TouchEntropyComponent\n\n  public cameraEnabled: boolean = true\n  public audioEnabled: boolean = true\n  public gyroEnabled: boolean = true\n  public touchEnabled: boolean = true\n\n  private readonly ENTROPY_STARTUP_TIME: number = 5\n  private startupTimeWaited: boolean = false\n\n  public entropy: { isFull: boolean } = {\n    isFull: false\n  }\n\n  constructor(\n    public readonly gyroService: GyroscopeNativeService,\n    public readonly entropyService: EntropyService,\n    public readonly cameraService: CameraNativeService,\n    public readonly audioService: AudioNativeService,\n    private readonly navigationService: NavigationService,\n    private readonly platform: Platform,\n    private readonly changeDetectorRef: ChangeDetectorRef,\n    private readonly permissionsService: PermissionsService\n  ) {\n    this.isBrowser = !this.platform.is('hybrid')\n    if (!this.isBrowser) {\n      this.cameraService.setTransparentElementsByTags('ion-toolbar', 'ion-content')\n    }\n    setTimeout(() => {\n      this.startupTimeWaited = true\n      this.checkEntropySourceStatus()\n    }, this.ENTROPY_STARTUP_TIME * 1000)\n  }\n\n  public checkEntropySourceStatus(): void {\n    if (this.startupTimeWaited) {\n      this.audioEnabled = this.audioService.getCollectedEntropyPercentage() !== 0\n      this.cameraEnabled = this.cameraService.getCollectedEntropyPercentage() !== 0\n      this.gyroEnabled = this.gyroService.getCollectedEntropyPercentage() !== 0\n      // Touch will never be disabled\n    }\n  }\n\n  public async ngOnInit(): Promise<void> {\n    await this.platform.ready()\n\n    if (this.isBrowser) {\n      this.cameraService.setVideoElement(this.videoElement)\n    }\n    this.cameraService.viewWillEnter()\n\n    await this.permissionsService.requestPermissions([PermissionTypes.CAMERA, PermissionTypes.MICROPHONE])\n\n    this.initEntropy()\n  }\n\n  public initEntropy(): void {\n    this.entropyService.addEntropySource(this.cameraService)\n    this.entropyService.addEntropySource(this.audioService)\n    this.entropyService.addEntropySource(this.gyroService)\n    this.entropyService.addEntropySource(this.touchEntropy)\n    this.entropyService\n      .startEntropyCollection()\n      .then(() => {\n        this.entropyService\n          .getEntropyUpdateObservable()\n          .pipe(auditTime(200))\n          .subscribe(() => {\n            this.checkEntropy()\n          })\n      })\n      .catch(handleErrorLocal(ErrorCategory.ENTROPY_COLLECTION))\n  }\n\n  public checkEntropy(): void {\n    this.changeDetectorRef.detectChanges()\n    this.checkEntropySourceStatus()\n\n    const enabledSources: boolean[] = [this.audioEnabled, this.cameraEnabled, this.gyroEnabled, this.touchEnabled]\n    const percentageNeeded: number = enabledSources.reduce((previous: number, isEnabled: boolean) => previous + (isEnabled ? 100 : 0), 0)\n\n    if (\n      Math.min(100, this.audioService.getCollectedEntropyPercentage()) +\n        Math.min(100, this.cameraService.getCollectedEntropyPercentage()) +\n        Math.min(100, this.gyroService.getCollectedEntropyPercentage()) +\n        Math.min(100, this.touchEntropy.getCollectedEntropyPercentage()) >=\n      percentageNeeded\n    ) {\n      this.entropy.isFull = true\n    }\n  }\n\n  public ionViewWillLeave(): void {\n    this.cameraService.viewWillLeave()\n  }\n\n  public ionViewDidLeave(): void {\n    this.entropyService.stopEntropyCollection().catch(handleErrorLocal(ErrorCategory.ENTROPY_COLLECTION))\n  }\n\n  public goToSecretRulesPage(): void {\n    this.entropyService\n      .getEntropyAsHex()\n      .then((hashHex: string) => {\n        const secret: Secret = new Secret(hashHex)\n\n        this.navigationService.routeWithState('secret-rules', { secret }).catch(handleErrorLocal(ErrorCategory.IONIC_NAVIGATION))\n      })\n      .catch(handleErrorLocal(ErrorCategory.ENTROPY_COLLECTION))\n  }\n}\n","<ion-header no-border>\n  <ion-toolbar>\n    <ion-buttons slot=\"start\">\n      <ion-back-button defaultHref=\"/secret-create\"></ion-back-button>\n    </ion-buttons>\n  </ion-toolbar>\n</ion-header>\n\n<ion-content class=\"ion-padding\">\n  <h1>{{ 'secret-generate.heading' | translate }}</h1>\n\n  <p>{{ 'secret-generate.text' | translate }}</p>\n\n  <airgap-touch-entropy #touchEntropy></airgap-touch-entropy>\n  <div id=\"entropy-description\"></div>\n\n  <p class=\"ion-padding-top\">{{ 'secret-generate.description' | translate }}</p>\n\n  <ion-row>\n    <ion-col class=\"ion-text-center\" [style.opacity]=\"cameraEnabled ? '1' : '0.2'\">\n      <ion-icon color=\"white\" src=\"assets/icons/md-videocam.svg\"></ion-icon>\n      <airgap-entropy-progress\n        id=\"entropy-video\"\n        [maxValue]=\"100\"\n        [value]=\"cameraService.getCollectedEntropyPercentage()\"\n      ></airgap-entropy-progress>\n    </ion-col>\n    <ion-col class=\"ion-text-center\" [style.opacity]=\"audioEnabled ? '1' : '0.2'\">\n      <ion-icon color=\"white\" src=\"assets/icons/md-mic.svg\"></ion-icon>\n      <airgap-entropy-progress\n        id=\"entropy-audio\"\n        [maxValue]=\"100\"\n        [value]=\"audioService.getCollectedEntropyPercentage()\"\n      ></airgap-entropy-progress>\n    </ion-col>\n    <ion-col class=\"ion-text-center\" [style.opacity]=\"gyroEnabled ? '1' : '0.2'\">\n      <ion-icon color=\"white\" src=\"assets/icons/md-screen_rotation.svg\"></ion-icon>\n      <airgap-entropy-progress\n        id=\"entropy-gyro\"\n        [maxValue]=\"100\"\n        [value]=\"gyroService.getCollectedEntropyPercentage()\"\n      ></airgap-entropy-progress>\n    </ion-col>\n    <ion-col class=\"ion-text-center\">\n      <ion-icon color=\"white\" src=\"assets/icons/md-touch_app.svg\"></ion-icon>\n      <airgap-entropy-progress\n        id=\"entropy-touch\"\n        [maxValue]=\"100\"\n        [value]=\"touchEntropy.getCollectedEntropyPercentage()\"\n      ></airgap-entropy-progress>\n    </ion-col>\n  </ion-row>\n\n  <video *ngIf=\"isBrowser\" #videoElement style=\"width: 100%\"></video>\n\n  <ion-fab vertical=\"bottom\" horizontal=\"end\" slot=\"fixed\">\n    <ion-button (click)=\"goToSecretRulesPage()\" color=\"primary\" shape=\"round\" [disabled]=\"!entropy.isFull\">\n      {{ 'secret-generate.continue_label' | translate }}\n    </ion-button>\n  </ion-fab>\n</ion-content>\n"],"sourceRoot":"webpack:///"}